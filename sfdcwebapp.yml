server:
  port: ${PORT:0}

management:
  endpoints:
    web:
      base-path: /manage
      exposure:
        include: '*'
  endpoint:
    health:
      roles: USER
      show-details: always
    configprops:
      keys-to-sanitize: "pwd,uid,password,secret,key,client_id,client_key"  # suffix or regex
    env:
      keys-to-sanitize: "pwd,uid,password,secret,key,client_id,client_key"  # suffix or regex

logging:
  level:
    org.springframework.cloud: ERROR
    io.pivotal.sfdc: ERROR
    com.force.api: DEBUG

sfdc:
  service:
    unavailable: '{"status":503,"data": "Service currently unavailable."}'

---
spring:
  profiles: local
  instance:
    nonSecurePort: ${server.port}
  redis:
    host: ${REDIS_HOST:redis}
    port: 6379
  sleuth.sampler.rate: 100
  sleuth.sampler.probability: 1.0
  zipkin.compression.enabled: true
  zipkin.baseUrl: http://wavefront-proxy.wavefront.svc.cluster.local:9411
  zipkin.sender.type: web

management:
  health.circuitbreakers.enabled: true
  metrics:
    tags.application: ${spring.application.name}
    distribution.percentiles-histogram.http.server.requests: true
    distribution.percentiles-histogram.resilience4j.circuitbreaker.calls: true
    enable.all: true
    export.wavefront:
      source: portalservice
      enabled: true
      uri: proxy://wavefront-proxy.wavefront.svc.cluster.local:2878
      step: 10s
    web.server.request.autotime.enabled: true

resilience4j.circuitbreaker:
    configs:
        default:
            registerHealthIndicator: true
            slidingWindowSize: 10
            minimumNumberOfCalls: 5
            permittedNumberOfCallsInHalfOpenState: 3
            automaticTransitionFromOpenToHalfOpenEnabled: true
            waitDurationInOpenState: 5s
            failureRateThreshold: 50
            eventConsumerBufferSize: 10
            recordExceptions:
                - org.springframework.web.client.HttpServerErrorException
                - java.util.concurrent.TimeoutException
                - java.io.IOException
            ignoreExceptions:
        shared:
            slidingWindowSize: 100
            permittedNumberOfCallsInHalfOpenState: 30
            waitDurationInOpenState: 1s
            failureRateThreshold: 50
            eventConsumerBufferSize: 10
            ignoreExceptions:
    instances:
        cacheBackend:
            baseConfig: default
